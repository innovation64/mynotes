---
{"dg-publish":true,"permalink":"/rl-column/hf-chapter2/2-4-vs/","dgPassFrontmatter":true,"noteIcon":"data:image/webp;base64,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"}
---


在深入学习Q-learning算法之前，我们需要先了解一下两种学习策略。

牢记智能体是**通过与其环境交互来进行学习的**，即**给定经验和收到来自环境的奖励，智能体将更新其价值函数或策略。**

蒙特卡洛和时序差分学习**在训练价值函数或策略函数上是两种不同的策略**，但他们都**使用经验来解决强化学习问题**。

蒙特卡洛**在学习之前使用整个回合的经验**；而时序差分则**只使用一个步骤(S_t, A_t, R_{t+1}, S_{t+1}\)来进行学习**。

我们将**使用一个基于价值的方法案例**来解释他们。

## 蒙特卡洛：在一个回合结束后进行学习

蒙克卡罗在回合结束时计算(G_t) (回报)并且使用其作为**一个更新的目标(V(S_t))**。

因此，在更新我们的价值函数之前，它需要一个**完整的交互过程。**

  <img src="https://huggingface.co/datasets/huggingface-deep-rl-course/course-images/resolve/main/en/unit3/monte-carlo-approach.jpg" alt="Monte Carlo"/>

举个例子：

  <img src="https://huggingface.co/datasets/huggingface-deep-rl-course/course-images/resolve/main/en/unit3/MC-2.jpg" alt="Monte Carlo"/>


- 我们始终从**相同的起点开始新的回合（episode）**。

- **智能体根据策略（policy）选择行动**。例如，使用一个 Epsilon Greedy 策略，该策略在探索（随机行动）和利用（利用之前经验）之间交替选择。

- 得到**奖励（reward）和下一个状态（next state）**。

- 如果猫吃掉老鼠或老鼠移动 > 10 步，则我们将终止该回合。

- 在该回合结束时，**我们会得到一个状态、行动、奖励和下一个状态的元组列表**。例如 [[状态为第三个瓷砖的底部，向左移动，+1，状态为第二个瓷砖的底部], [状态为第二个瓷砖的底部，向左移动，+0，状态为第一个瓷砖的底部]...]

- **智能体将计算总奖励 \(G_t\)（以衡量其性能）**。

- 然后，它将基于以下公式**更新 \(V(s_t)\)**。

  <img src="https://huggingface.co/datasets/huggingface-deep-rl-course/course-images/resolve/main/en/unit3/MC-3.jpg" alt="Monte Carlo"/>

- 最后**以这些新知识来重新开始游戏**

通过训练的回合越来越多，智能体会把游戏玩的越来越好。

  <img src="https://huggingface.co/datasets/huggingface-deep-rl-course/course-images/resolve/main/en/unit3/MC-3p.jpg" alt="Monte Carlo"/>

例如，如果用蒙特卡洛训练了一个状态价值函数

- 我们刚刚开始训练值函数，所以它将为每个状态返回值0。

- 学习率（lr）为0.1，折扣率为1（没有折扣）。

- 小老鼠将探索环境并采取随机动作。

  <img src="https://huggingface.co/datasets/huggingface-deep-rl-course/course-images/resolve/main/en/unit3/MC-4.jpg" alt="Monte Carlo"/>


- 小老鼠的移动超过了十步，所以回合结束。

  <img src="https://huggingface.co/datasets/huggingface-deep-rl-course/course-images/resolve/main/en/unit3/MC-4p.jpg" alt="Monte Carlo"/>


- 我们有一系列的状态、动作、奖励以及下一个状态，**所以现在我们需要计算回报（G{t}）**

- \\(G_t = R_{t+1} + R_{t+2} + R_{t+3} ...\\)

- \\(G_t = R_{t+1} + R_{t+2} + R_{t+3}…\\) (为简单起见，我们不对奖励进行折扣计算).

- \\(G_t = 1 + 0 + 0 + 0+ 0 + 0 + 1 + 1 + 0 + 0\\)

- \\(G_t= 3\\)

- 现在可以计算**新的** \\(V(S_0)\\):

  <img src="https://huggingface.co/datasets/huggingface-deep-rl-course/course-images/resolve/main/en/unit3/MC-5.jpg" alt="Monte Carlo"/>

- (V(S_0) = V(S_0) + lr * [G_t — V(S_0)])

- (V(S_0) = 0 + 0.1 * [3 – 0])

- (V(S_0) = 0.3)


  <img src="https://huggingface.co/datasets/huggingface-deep-rl-course/course-images/resolve/main/en/unit3/MC-5p.jpg" alt="Monte Carlo"/>

## 时序差分算法：在每一步进行学习

另一方面，**时序差分学习只需要一次交互（一步）S{t+1}**，就可以形成一个TD目标，并使用 R{t+1} 和 γ*V(S_{t+1}) 更新 V(S_t)。

**TD算法的思想是在每一步都对 V(S_t) 进行更新。**

但是因为我们没有经历整个回合，所以我们没有 (G_t)（期望回报）。相反，**我们通过添加 (R_{t+1}) 和下一个状态的折扣值来估计 (G_t)。**

这被称为自举（bootstrapping），**因为时序差分方法的更新部分是基于现有估值 V(S_{t+1}) 而不是完整样本 (G_t)**。

  <img src="https://huggingface.co/datasets/huggingface-deep-rl-course/course-images/resolve/main/en/unit3/TD-1.jpg" alt="Temporal Difference"/>

这种方法称为TD(0)或**单步TD（在任何单个步骤后更新值函数）。**

  <img src="https://huggingface.co/datasets/huggingface-deep-rl-course/course-images/resolve/main/en/unit3/TD-1p.jpg" alt="Temporal Difference"/>

我们还是以猫和老鼠为例:

  <img src="https://huggingface.co/datasets/huggingface-deep-rl-course/course-images/resolve/main/en/unit3/TD-2.jpg" alt="Temporal Difference"/>

- 我们刚刚开始训练我们的价值函数，所以在每个状态都返回0值。

- 我们的学习率是0.1，并且折扣率为1（没有折扣）。

- 小老鼠探索环境并采取随机行为：**向左移动**

- 他得到了一个奖励 R_{t+1} = 1，因为**它吃到了一块芝士**

  <img src="https://huggingface.co/datasets/huggingface-deep-rl-course/course-images/resolve/main/en/unit3/TD-2p.jpg" alt="Temporal Difference"/>
  


  <img src="https://huggingface.co/datasets/huggingface-deep-rl-course/course-images/resolve/main/en/unit3/TD-3.jpg" alt="Temporal Difference"/>

现在我们更新V(S_0)

新  (V(S_0) = V(S_0) + lr * [R_1 + \gamma * V(S_1) - V(S_0)])

新 (V(S_0) = 0 + 0.1 * [1 + 1 * 0–0])

新 (V(S_0) = 0.1)

所以我们从状态0开始更新我们的价值函数。

现在我们**持续与这个环境进行交互，并更新价值函数。**

  <img src="https://huggingface.co/datasets/huggingface-deep-rl-course/course-images/resolve/main/en/unit3/TD-3p.jpg" alt="Temporal Difference"/>

总结一下：

  - 在蒙特卡洛算法中，我们从完整的回合中更新价值函数，并使用本回合中确定的折扣回报。
  - 在时序差分算法中，我们在每一步都对价值函数进行更新，所以我们将还没有获得的 (G_t) 替换为估计的回报，即TD-target。

  <img src="https://huggingface.co/datasets/huggingface-deep-rl-course/course-images/resolve/main/en/unit3/Summary.jpg" alt="Summary"/>